{
	"variables": {
		"instance_type": "c4.xlarge",
		"source_ami": "ami-5e6bce3e",
		"region": "us-west-2"
	},

	"builders": [
		{
			"type": "amazon-ebs",
			"region": "{{user `region`}}",
			"source_ami": "{{user `source_ami`}}",
			"instance_type": "{{user `instance_type`}}",
			"ami_name": "windows-ssh-ami {{timestamp}}",
			"user_data_file": "{{template_dir}}/../common/builder-userdata.ps1",
			"communicator": "ssh",
			"ssh_username": "Administrator",
			"ssh_timeout": "30m",
			"disable_stop_instance": "true"
		}
	],

	"_comment": "The shell provisioner doesn't work well with Windows, so some hackery",
	"provisioners": [
		{
			"type": "shell",
			"execute_command": "powershell {{ .Path }}",
			"remote_path": "C:\\button-down.ps1",
			"script": "{{template_dir}}/../common/button-down.ps1"
		},
		{
			"type": "shell",
			"execute_command": "powershell {{ .Path }}",
			"remote_path": "C:\\git.ps1",
			"script":"git.ps1"
		},
		{
			"type": "shell",
			"execute_command": "powershell {{ .Path }}",
			"remote_path": "C:\\jdk.ps1",
			"script":"jdk.ps1"
		},
		{
			"type": "file",
			"source": "{{template_dir}}/../common/specialize-script.ps1",
			"destination": "C:\\specialize-script.ps1"
		},
		{
			"type": "shell",
			"execute_command": "powershell {{ .Path }}",
			"remote_path": "C:\\provision.ps1",
			"script": "{{template_dir}}/../common/provision.ps1"
		}
	]
}
